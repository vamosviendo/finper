{% extends 'diario/base.html' %}
{% load static %}
{% load historicos %}
{% block extra-css %}
<link rel="stylesheet" href="{% static '/diario/css/home.css' %}">
{% endblock extra-css %}

{% block contenido %}
<div id = "id_div_saldo_gral" class="Titulo">
  <h1>Saldo general: <span id="id_importe_saldo_gral">{{ saldo_gral|floatformat:2 }}</span></h1>
</div>

<div id="id_div_menu_titulares" style="float: left;">
  <table class="menu">
    <colgroup>
      <col class="div-menu div-titulares"/>
    </colgroup>
    <tbody>
      {% for titular in titulares %}
      <tr class="menu-row class_div_titular">
        <td class="menu-item">
          <div class="menu-item-content class_div_nombre_titular">
            {{ titular.nombre }}
          </div>
          <div class="menu-item-edit">E</div>
          <div class="menu-item-edit">B</div>
        </td>
      </tr>
      {% endfor %}
      <tr class="menu-row">
        <td class="menu-item"><div>+</div></td>
        <td></td>
        <td></td>
      </tr>
    </tbody>
  </table>
</div>

<div id="id_div_menu_cuentas">
  <table class="menu">
    <colgroup>
      <col class="div-menu div-cuentas"/>
      <col span="3" class="div-menu div-detalles-cuenta"/>
    </colgroup>
    <tbody>
      {% for cuenta in subcuentas %}
        <tr class="menu-row class_div_cuenta">
          <td class="menu-item">
            <div class="menu-item-content class_nombre_cuenta">
              {{ cuenta.nombre }}
            </div>
            <div class="menu-item-edit">E</div>
            <div class="menu-item-edit">B</div>
          </td>
          <td class="numero chico class_saldo_cuenta">{{ cuenta.saldo|floatformat:2 }}</td>
          <td>{{ cuenta.ultimo_saldo }}</td>
          <td>{{ cuenta.tiene_madre }}</td>
        </tr>
        {% for subcuenta in cuenta.subcuentas.all %}
          <tr class="div-subcuentas">
            <td class="menu-item">
              <div class="menu-item-content">
                {{ subcuenta.nombre }}
              </div>
              <div class="menu-item-edit">E</div>
              <div class="menu-item-edit">B</div>
            </td>
            <td class="numero chico class_saldo_cuenta">{{ cuenta.saldo|floatformat:2 }}</td>
            <td>{{ cuenta.ultimo_saldo }}</td>
            <td>{{ cuenta.tiene_madre }}</td>
          </tr>
        {% endfor %}
      {% endfor %}
      <tr class="menu-row">
        <td class="menu-item"><div>+</div></td>
        <td></td>
        <td></td>
      </tr>
    </tbody>
  </table>
</div>

<section id="id_lista_ult_movs" style="clear: both;">
  <a href="{% url 'mov_nuevo' %}" id="id_btn_mov_nuevo">
    Movimiento nuevo
  </a>
  <div>
    <table id="id_table_movimientos" class="table-striped planilla">
      <thead><tr>
        <th id="id_th_fecha ">Fecha</th>
        <th id="id_th_concepto">Concepto</th>
        <th id="id_th_detalle">Detalle</th>
        <th id="id_th_importe">Importe</th>
        <th id="id_th_cuentas">Cuentas</th>
        <th class="chico fondo_resaltado" id="id_th_general">General</th>
        {% for subc in subcuentas %}
        <th class="chico" id="id_th_{{ subc.slug }}">
          <div class="cell_cuenta scrollable">
            {{ subc.slug }}
          </div>
        </th>
        {% endfor %}
        <th>Menu</th>
      </tr></thead>

      {% for mov in movimientos reversed %}
      <tr class="class_row_mov">
        <td class="class_td_fecha">
          <div class="cell_fecha scrollable">
            {{ mov.fecha|date:'Y-m-d' }}
          </div>
        </td>

        <td class="class_td_concepto" title="{{ mov.detalle }}">
          <div class="cell_concepto scrollable">
            {{ mov.concepto }}
          </div>
        </td>

        <td class="class_td_detalle">
          <div class="cell_detalle scrollable">
            {{ mov.detalle|default_if_none:""|truncatechars:50 }}
          </div>
        </td>

        <td class="numero class_td_importe" title="{{ mov.str_cuentas }}">
          {{ mov.importe|floatformat:2 }}
        </td>

        <td class="class_td_cuentas">
          <div class="cell_cuentas scrollable">
            {{ mov.str_cuentas }}
          </div>
        </td>

        <td class="numero chico fondo_resaltado class_td_general">
          {% with mov as mov %}
            {% block general %}{% historico_general mov %}{% endblock general %}
          {% endwith %}
        </td>

        {% for subc in subcuentas %}
        <td class="{% include './snippets/color_saldos.html' %}
                  numero chico class_td_saldo class_td_{{ subc.slug }}"
        >
          {% historico subc mov %}
        </td>
        {% endfor %}

        <td class="class_td_menu">
          {% if not mov.es_automatico %}
          <a href="{% url 'mov_elim' mov.id %}"
             class="class_link_elim_mov">
            B
          </a>
          <a href="{% url 'mov_mod' mov.id %}"
             class="class_link_mod_mov">
            E
          </a>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>
</section>

{% endblock contenido %}

{% block extrajs %}
<script>
  $(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip();
  });
</script>
{% endblock extrajs %}
{% comment %} Distribuci√≥n anterior basada en base_contenido.html {% endcomment %}
{% comment %}
{% block importe_saldo_pag %}
  {{saldo_gral|floatformat:2}}
{% endblock importe_saldo_pag %}

{% block verificar_saldos %}
<a href="{% url 'verificar_saldos' %}" id="id_btn_verificar_saldos" class="btn my-3 btn-primary">
  Verificar saldos
</a>
{% endblock verificar_saldos %}

{% block general %}
  {% historico_general mov %}
{% endblock general %}
{% endcomment %}